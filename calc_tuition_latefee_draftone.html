<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Late Fee Daily Ledger Simulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!--
====================================================================================
LATE FEE DAILY LEDGER SIMULATOR
====================================================================================

PURPOSE
-------
This page simulates how DAILY LATE FEES are generated, capped, approved, cancelled,
and recorded for a tuition installment invoice.

This is a FRONT-END SIMULATION ONLY.
No database is used.
No data is persisted after refresh.

This file is intentionally LONG and EXPLICIT to ensure:
- clarity for non-technical stakeholders
- audit-style readability
- future developer handover
- policy traceability

------------------------------------------------------------------------------------
CORE RULES IMPLEMENTED
------------------------------------------------------------------------------------

1. Late fee is recorded DAILY (1 row per day)
2. Late fee amount is FIXED per day (default 20,000)
3. Late fee starts AFTER due date (00:00 boundary)
4. Maximum late fee duration = 5 days
5. Maximum total late fee = 100,000
6. Tuition payment and late fee payment are SEPARATE
7. Accountant approval date determines cancellation logic
8. History is NEVER deleted
9. Rows after payment date are MARKED cancelled (is_cancelled = 1)
10. Tables reset on each simulation run

------------------------------------------------------------------------------------
SCENARIOS COVERED
------------------------------------------------------------------------------------

- Parent pays on working day
- Parent pays on non-working day
- Parent pays tuition but not late fee
- Parent pays late fee later
- Student suspension logic is implied (not enforced here)

====================================================================================
-->

<style>

/* ==================================================================================
   GLOBAL RESET
   ================================================================================== */

* {
  box-sizing: border-box;
}

/* ==================================================================================
   PAGE BASE STYLING
   ================================================================================== */

body {
  margin: 0;
  padding: 0;
  background: #f6f7fb;
  color: #111827;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  font-size: 13px;
  line-height: 1.4;
}

/* ==================================================================================
   PAGE CONTAINER
   ================================================================================== */

.container {
  max-width: 1100px;
  margin: 20px auto;
  padding: 0 16px 60px;
}

/* ==================================================================================
   HEADERS
   ================================================================================== */

h1 {
  font-size: 20px;
  margin: 0 0 4px 0;
}

.subtitle {
  font-size: 12px;
  color: #6b7280;
  margin-bottom: 18px;
}

/* ==================================================================================
   CARD LAYOUT
   ================================================================================== */

.card {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 18px;
  box-shadow: 0 10px 22px rgba(17, 24, 39, 0.06);
}

/* ==================================================================================
   FORM ROWS
   ================================================================================== */

.row {
  display: grid;
  grid-template-columns: 240px 1fr;
  gap: 12px;
  align-items: center;
  margin-bottom: 12px;
}

label {
  font-weight: 700;
  color: #374151;
}

/* ==================================================================================
   INPUTS
   ================================================================================== */

input {
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  font-size: 13px;
}

input:focus {
  outline: none;
  border-color: #2563eb;
}

/* ==================================================================================
   MONOSPACE (IDs, Invoice Numbers)
   ================================================================================== */

.mono {
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
}

/* ==================================================================================
   MONEY INPUTS
   ================================================================================== */

.money {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

/* ==================================================================================
   BUTTONS
   ================================================================================== */

button {
  padding: 10px 16px;
  border-radius: 10px;
  border: none;
  background: #111827;
  color: #ffffff;
  font-weight: 700;
  cursor: pointer;
  font-size: 13px;
}

button:hover {
  opacity: 0.9;
}

button.orange {
  background: #f97316;
}

/* ==================================================================================
   TABLE STYLES
   ================================================================================== */

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
  font-size: 12px;
}

th,
td {
  border: 1px solid #e5e7eb;
  padding: 8px;
}

th {
  background: #f9fafb;
  font-weight: 700;
  color: #374151;
}

/* ==================================================================================
   ALIGNMENT HELPERS
   ================================================================================== */

.center {
  text-align: center;
}

.right {
  text-align: right;
}

/* ==================================================================================
   BADGES (NULL / OK / CANCELLED)
   ================================================================================== */

.badge {
  padding: 2px 8px;
  border-radius: 999px;
  font-weight: 700;
  font-size: 11px;
  display: inline-block;
}

.badge.null {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  color: #6b7280;
}

.badge.ok {
  background: #ecfdf5;
  color: #065f46;
  border: 1px solid #bbf7d0;
}

.badge.bad {
  background: #fef2f2;
  color: #b91c1c;
  border: 1px solid #fecaca;
}

</style>
</head>

<body>

<div class="container">

<!-- ================================================================================
     PAGE HEADER
     ================================================================================ -->

<h1>Late Fee Daily Ledger Simulator</h1>
<div class="subtitle">
This tool simulates daily late fee ledger behavior with accountant approval logic.
</div>

<!-- ================================================================================
     INPUT SECTION
     ================================================================================ -->

<div class="card">

  <div class="row">
    <label>Student ID</label>
    <input id="studentId" class="mono" value="PR25004">
  </div>

  <div class="row">
    <label>Student Name</label>
    <input id="studentName" value="Aye Aye">
  </div>

  <div class="row">
    <label>Tuition Invoice Nr</label>
    <input id="invoiceNr" class="mono" value="INV25046-07">
  </div>

  <div class="row">
    <label>Late Fee Amount (per day)</label>
    <input id="lateFee" class="money mono" value="20000">
  </div>

  <div class="row">
    <label>Due Date</label>
    <input id="dueDate" type="date" value="2026-01-01">
  </div>

  <div class="row">
    <label>Tuition Payment Date</label>
    <input id="tuitionPayDate" type="date" value="2026-01-03">
  </div>

  <div class="row">
    <label>Late Fee Payment Date</label>
    <input id="latePayDate" type="date" value="2026-01-03">
  </div>

  <div class="row">
    <label>Accountant-Approve-Payment-Date</label>
    <input id="approveDate" type="date" value="2026-01-05">
  </div>

  <button class="orange" onclick="runSimulation()">Run Simulation</button>

</div>

<!-- ================================================================================
     LEDGER TABLES
     ================================================================================ -->

<div class="card">
  <h3>Ledger on Tuition Payment Date</h3>
  <table>
    <thead>
      <tr>
        <th>Student ID</th>
        <th>Invoice</th>
        <th>Date</th>
        <th class="right">Late Fee</th>
        <th class="center">is_cancelled</th>
        <th>payment_date</th>
      </tr>
    </thead>
    <tbody id="tbl1"></tbody>
  </table>
</div>

<div class="card">
  <h3>Ledger on Late Fee Payment Date</h3>
  <table>
    <thead>
      <tr>
        <th>Student ID</th>
        <th>Invoice</th>
        <th>Date</th>
        <th class="right">Late Fee</th>
        <th class="center">is_cancelled</th>
        <th>payment_date</th>
      </tr>
    </thead>
    <tbody id="tbl2"></tbody>
  </table>
</div>

<div class="card">
  <h3>Ledger After Accountant Approval</h3>
  <table>
    <thead>
      <tr>
        <th>Student ID</th>
        <th>Invoice</th>
        <th>Date</th>
        <th class="right">Late Fee</th>
        <th class="center">is_cancelled</th>
        <th>payment_date</th>
      </tr>
    </thead>
    <tbody id="tbl3"></tbody>
  </table>
</div>

</div>

<script>

/* ================================================================================
   MAIN SIMULATION LOGIC
   ================================================================================ */

function runSimulation() {

  /* -------------------------------------------------------------------------------
     READ INPUT VALUES
     ------------------------------------------------------------------------------- */

  const studentId = document.getElementById("studentId").value;
  const invoiceNr = document.getElementById("invoiceNr").value;
  const dailyFee = Number(document.getElementById("lateFee").value);

  const dueDate = new Date(document.getElementById("dueDate").value);
  const tuitionPayDate = new Date(document.getElementById("tuitionPayDate").value);
  const latePayDate = new Date(document.getElementById("latePayDate").value);
  const approveDate = new Date(document.getElementById("approveDate").value);

  /* -------------------------------------------------------------------------------
     HELPER: BUILD DAILY LEDGER ROWS (MAX 5 DAYS)
     ------------------------------------------------------------------------------- */

  function buildLedger(asOfDate) {
    const rows = [];
    let current = new Date(dueDate);

    for (let i = 0; i < 5; i++) {
      if (current >= asOfDate) break;

      rows.push({
        date: new Date(current),
        cancelled: null,
        paymentDate: null
      });

      current.setDate(current.getDate() + 1);
    }

    return rows;
  }

  /* -------------------------------------------------------------------------------
     HELPER: RENDER TABLE
     ------------------------------------------------------------------------------- */

  function renderTable(targetId, rows, applyApproval) {
    const tbody = document.getElementById(targetId);
    tbody.innerHTML = "";

    if (applyApproval) {
      rows.forEach(r => {
        r.paymentDate = latePayDate;
        r.cancelled = r.date < latePayDate ? 0 : 1;
      });
    }

    if (rows.length === 0) {
      tbody.innerHTML =
        `<tr><td colspan="6" class="center">No late fee rows</td></tr>`;
      return;
    }

    rows.forEach(r => {
      tbody.innerHTML += `
        <tr>
          <td class="mono">${studentId}</td>
          <td class="mono">${invoiceNr}</td>
          <td class="mono">${r.date.toISOString().slice(0,10)}</td>
          <td class="right mono">${dailyFee.toLocaleString()}</td>
          <td class="center">${
            r.cancelled === null
              ? "<span class='badge null'>NULL</span>"
              : r.cancelled === 0
              ? "<span class='badge ok'>0</span>"
              : "<span class='badge bad'>1</span>"
          }</td>
          <td class="mono">${
            r.paymentDate
              ? r.paymentDate.toISOString().slice(0,10)
              : "<span class='badge null'>NULL</span>"
          }</td>
        </tr>`;
    });
  }

  /* -------------------------------------------------------------------------------
     EXECUTION
     ------------------------------------------------------------------------------- */

  renderTable("tbl1", buildLedger(tuitionPayDate), false);
  renderTable("tbl2", buildLedger(latePayDate), false);
  renderTable("tbl3", buildLedger(approveDate), true);
}

</script>

</body>
</html>
