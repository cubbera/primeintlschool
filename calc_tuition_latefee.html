<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>School Tuition Late Fee Simulator</title>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f8f9fa;
    }
    h2 {
        background: #343a40;
        color: white;
        padding: 10px;
    }
    fieldset {
        border: 1px solid #ccc;
        padding: 15px;
        margin-bottom: 20px;
        background: white;
    }
    label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
    }
    input {
        padding: 5px;
        width: 250px;
    }
    button {
        margin-top: 15px;
        padding: 10px 20px;
        font-weight: bold;
        cursor: pointer;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: white;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
    }
    th {
        background: #e9ecef;
    }
    .line {
        border-top: 3px solid #000;
        margin: 30px 0;
    }
    .status {
        font-weight: bold;
        font-size: 16px;
    }
</style>
</head>

<body>

<h2>PART 1 – Calculate Late Fee</h2>

<fieldset>
    <label>Student ID</label>
    <input id="studentId" value="PR25004">

    <label>Student Name</label>
    <input id="studentName" value="Aye Aye">

    <label>Tuition Invoice Nr</label>
    <input id="invoiceNo" value="INV25046-07">

    <label>Late Fee Amount (per day)</label>
    <input id="lateFeeAmount" type="number" value="20000">

    <label>Due Date</label>
    <input id="dueDate" type="date" value="2026-01-01">

    <label>Payment Date (Parent Paid)</label>
    <input id="paymentDate" type="date">

    <button onclick="calculateLateFee()">Calculate Late Fee</button>

    <p class="status">Calculated Late Fee: <span id="lateFeeResult">0</span></p>
    <p class="status">Student Status: <span id="studentStatus">ACTIVE</span></p>
</fieldset>

<div class="line"></div>

<h2>Simulate Database (Accountant Actions)</h2>

<fieldset>
    <label>Accountant Approve Payment Date</label>
    <input id="approveDate" type="date">

    <label>Tuition Payment Date</label>
    <input id="tuitionPaymentDate" type="date">

    <label>Late Fee Payment Date</label>
    <input id="lateFeePaymentDate" type="date">

    <button onclick="runSimulation()">Run Simulation</button>
</fieldset>

<div class="line"></div>

<h2>PART 2 – Late Fee Daily Ledger Tables</h2>

<h3>Ledger on Tuition Payment Date</h3>
<table id="tuitionTable"></table>

<h3>Ledger on Late Fee Payment Date</h3>
<table id="lateFeeTable"></table>

<h3>Ledger on Accountant Approve Payment Date</h3>
<table id="approveTable"></table>

<script>
let ledger = [];

function resetTables() {
    ledger = [];
    document.getElementById("tuitionTable").innerHTML = "";
    document.getElementById("lateFeeTable").innerHTML = "";
    document.getElementById("approveTable").innerHTML = "";
}

function daysBetween(d1, d2) {
    return Math.floor((d2 - d1) / (1000 * 60 * 60 * 24));
}

function calculateLateFee() {
    resetTables();

    const dueDate = new Date(document.getElementById("dueDate").value);
    const paymentDate = new Date(document.getElementById("paymentDate").value);
    const dailyFee = parseInt(document.getElementById("lateFeeAmount").value);

    if (isNaN(paymentDate)) {
        alert("Please enter payment date.");
        return;
    }

    let daysLate = daysBetween(dueDate, paymentDate);
    if (daysLate < 0) daysLate = 0;
    if (daysLate > 5) daysLate = 5;

    const totalLateFee = daysLate * dailyFee;
    document.getElementById("lateFeeResult").innerText = totalLateFee.toLocaleString();

    if (paymentDate >= new Date("2026-01-07")) {
        document.getElementById("studentStatus").innerText = "FINANCIALLY SUSPENDED";
    } else {
        document.getElementById("studentStatus").innerText = "ACTIVE";
    }

    // Generate daily ledger
    for (let i = 0; i < daysLate; i++) {
        const d = new Date(dueDate);
        d.setDate(d.getDate() + i);
        ledger.push({
            date: d,
            amount: dailyFee,
            is_cancelled: null,
            payment_date: null
        });
    }
}

function runSimulation() {
    const tuitionPay = new Date(document.getElementById("tuitionPaymentDate").value);
    const lateFeePay = new Date(document.getElementById("lateFeePaymentDate").value);
    const approveDate = new Date(document.getElementById("approveDate").value);

    ledger.forEach(row => {
        if (!isNaN(lateFeePay) && row.date <= lateFeePay) {
            row.payment_date = lateFeePay;
            row.is_cancelled = 0;
        }
        if (!isNaN(lateFeePay) && row.date > lateFeePay) {
            row.payment_date = lateFeePay;
            row.is_cancelled = 1;
        }
    });

    renderTable("tuitionTable", tuitionPay);
    renderTable("lateFeeTable", lateFeePay);
    renderTable("approveTable", approveDate);
}

function renderTable(tableId, filterDate) {
    let html = `
        <tr>
            <th>Student ID</th>
            <th>Invoice</th>
            <th>Late Fee Date</th>
            <th>Late Fee Amount</th>
            <th>Is Cancelled</th>
            <th>Payment Date</th>
        </tr>`;

    ledger.forEach(row => {
        if (isNaN(filterDate) || row.date <= filterDate) {
            html += `
            <tr>
                <td>${document.getElementById("studentId").value}</td>
                <td>${document.getElementById("invoiceNo").value}</td>
                <td>${row.date.toDateString()}</td>
                <td>${row.amount.toLocaleString()}</td>
                <td>${row.is_cancelled === null ? "NULL" : row.is_cancelled}</td>
                <td>${row.payment_date ? row.payment_date.toDateString() : "NULL"}</td>
            </tr>`;
        }
    });

    document.getElementById(tableId).innerHTML = html;
}
</script>

</body>
</html>