<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tuition Proration & Refund Calculator</title>

<style>
body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:#f6f7fb;
  padding:24px;
}
h2{margin-top:0}
.card{
  background:#fff;
  border:1px solid #ddd;
  border-radius:12px;
  padding:20px;
  margin-bottom:20px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
}
.field{
  display:flex;
  flex-direction:column;
  gap:6px;
}
label{font-size:13px;color:#555}
input{
  padding:10px;
  border:1px solid #ccc;
  border-radius:8px;
  font-size:14px;
}
input[readonly]{background:#f3f4f6}
.discount{color:#b91c1c;font-weight:600}
button{
  padding:14px 22px;
  font-size:15px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
.btn{
  background:#111;
  color:#fff;
}
.result{
  background:#f9fafb;
  border:1px dashed #bbb;
}
.money{font-variant-numeric: tabular-nums}
.term{
  padding:6px 10px;
  border-radius:6px;
  font-size:13px;
  color:#fff;
  text-align:center;
}
.t1{background:#2563eb}
.t2{background:#059669}
.t3{background:#9333ea}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
  font-size:13px;
}
th{background:#f3f4f6}
.month{
  padding:6px;
  border-radius:6px;
  color:#fff;
}
</style>
</head>

<body>

<h2>Tuition Proration & Refund Calculator</h2>

<div class="card">
  <div class="grid">
    <div class="field">
      <label>Base Tuition Fee (Annual)</label>
      <input id="baseFee" type="text" placeholder="10,000,000">
    </div>

    <div class="field">
      <label>Join Date</label>
      <input id="joinDate" type="date">
    </div>

    <div class="field">
      <label>Academic Year – Term (Join)</label>
      <input id="joinTerm" readonly>
    </div>

    <div class="field">
      <label>Tuition Fee Before Discount (After Prorate)</label>
      <input id="proratedFee" readonly class="money">
    </div>

    <div class="field">
      <label>Discount #1</label>
      <input id="disc1" class="discount" placeholder="-100,000">
    </div>

    <div class="field">
      <label>Discount #2</label>
      <input id="disc2" class="discount" placeholder="-50,000">
    </div>

    <div class="field">
      <label>Final Tuition Fee After Discount</label>
      <input id="finalFee" readonly class="money">
    </div>

    <div class="field">
      <label>Leave Date</label>
      <input id="leaveDate" type="date">
    </div>

    <div class="field">
      <label>Academic Year – Term (Leave)</label>
      <input id="leaveTerm" readonly>
    </div>
  </div>

  <div style="margin-top:20px">
    <button class="btn" onclick="calculate()">Calculate</button>
  </div>
</div>

<div class="card result">
  <h3>Result</h3>
  <div class="grid">
    <div class="field">
      <label>Refundable Amount</label>
      <input id="refundAmount" readonly class="money">
    </div>
    <div class="field">
      <label>Refundable Term (Total Months)</label>
      <input id="refundMonths" readonly>
    </div>
  </div>
</div>

<div class="card">
  <h3>Academic Year Term Calendar</h3>

  <table>
    <tr>
      <th colspan="12">AY2025–2026</th>
    </tr>
    <tr>
      <td class="month t1">Jun 25</td>
      <td class="month t1">Jul</td>
      <td class="month t1">Aug</td>
      <td class="month t2">Sep</td>
      <td class="month t2">Oct</td>
      <td class="month t2">Nov</td>
      <td class="month t3">Dec</td>
      <td class="month t3">Jan 26</td>
      <td class="month t3">Feb</td>
      <td class="month t3">Mar</td>
      <td></td><td></td>
    </tr>
  </table>

  <table>
    <tr>
      <th colspan="12">AY2026–2027</th>
    </tr>
    <tr>
      <td class="month t1">Jun 26</td>
      <td class="month t1">Jul</td>
      <td class="month t1">Aug</td>
      <td class="month t2">Sep</td>
      <td class="month t2">Oct</td>
      <td class="month t2">Nov</td>
      <td class="month t3">Dec</td>
      <td class="month t3">Jan 27</td>
      <td class="month t3">Feb</td>
      <td class="month t3">Mar</td>
      <td></td><td></td>
    </tr>
  </table>
</div>

<script>
const TERMS = {
  "2025": [
    {term:"T1", start:"2025-06-10", end:"2025-08-29", months:3},
    {term:"T2", start:"2025-09-01", end:"2025-11-28", months:3},
    {term:"T3", start:"2025-12-01", end:"2026-04-03", months:4}
  ],
  "2026": [
    {term:"T1", start:"2026-06-16", end:"2026-09-04", months:3},
    {term:"T2", start:"2026-09-07", end:"2026-12-18", months:3},
    {term:"T3", start:"2027-01-05", end:"2027-03-31", months:4}
  ]
};

function parseMoney(v){
  return Number(v.replace(/,/g,''))||0;
}
function fmt(n){
  return n.toLocaleString("en-US");
}
function findTerm(d){
  const y = d.getFullYear();
  for(const ay in TERMS){
    for(const t of TERMS[ay]){
      if(d>=new Date(t.start) && d<=new Date(t.end)){
        return {ay, term:t.term, months:t.months};
      }
    }
  }
  return null;
}

function calculate(){
  const base = parseMoney(baseFee.value);
  const monthly = base/10;

  const jd = new Date(joinDate.value);
  const ld = new Date(leaveDate.value);

  const jt = findTerm(jd);
  const lt = findTerm(ld);

  joinTerm.value = jt ? `AY${jt.ay} – ${jt.term}` : "";
  leaveTerm.value = lt ? `AY${lt.ay} – ${lt.term}` : "";

  const joinMonth = jd.getMonth();
  const startMonth = 5; // June
  const usedMonths = Math.max(0, joinMonth - startMonth);
  const payableMonths = 10 - usedMonths;

  const prorate = payableMonths * monthly;
  proratedFee.value = fmt(prorate);

  const totalDisc = parseMoney(disc1.value)+parseMoney(disc2.value);
  const final = prorate + totalDisc;
  finalFee.value = fmt(final);

  let refundMonths = 0;
  if(jt && lt){
    const terms = TERMS[jt.ay];
    const leaveIndex = terms.findIndex(t=>t.term===lt.term);
    for(let i=leaveIndex+1;i<terms.length;i++){
      refundMonths += terms[i].months;
    }
  }

  refundMonths.value = refundMonths;
  refundAmount.value = fmt(refundMonths*monthly);
}
</script>

</body>
</html>
