<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Enrollment & Tuition Plan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body{
    font-family:-apple-system,BlinkMacSystemFont,system-ui;
    background:#f5f5f7;
    padding:24px;
  }
  .container{
    max-width:1100px;
    margin:auto;
    background:#fff;
    padding:32px;
    border-radius:14px;
  }
  h2{
    margin-top:32px;
    border-bottom:1px solid #ddd;
    padding-bottom:6px;
  }
  .row{
    display:flex;
    align-items:center;
    gap:16px;
    margin-top:14px;
    flex-wrap:wrap;
  }
  .label{
    min-width:220px;
    font-weight:600;
    color:#111;
  }
  input,select{
    padding:8px 10px;
    font-size:14px;
    min-width:240px;
  }

  /* radio */
  .radio-row{
    display:flex;
    align-items:center;
    gap:44px;
    margin-top:16px;
    justify-content:flex-start;
  }
  .radio-row label{
    display:flex;
    align-items:center;
    gap:8px;
    font-weight:600;
    color:#111;
  }

  /* highlighted amounts */
  .money-badge{
    display:inline-flex;
    align-items:center;
    justify-content:flex-end;
    min-width:160px;
    padding:6px 12px;
    border-radius:10px;
    background:#f1f5f9;
    color:#0f172a;
    font-weight:800;
    letter-spacing:0.2px;
  }
  .money-badge.red{
    background:#fff1f2;
    color:#9f1239;
  }

  /* student id badge */
  .student-id-badge{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:8px 14px;
    border-radius:999px;
    background:#e0f2fe;
    color:#0369a1;
    font-weight:800;
  }

  /* discounts: table box (smaller font) */
  .discount-box{
    margin-top:16px;
    border:1px solid #e5e7eb;
    border-radius:12px;
    padding:12px;
    background:#fafafa;
  }
  .discount-box h3{
    margin:0 0 10px 0;
    font-size:14px;
    font-weight:800;
    color:#111;
  }
  .disc-table{
    width:100%;
    border-collapse:separate;
    border-spacing:0;
    font-size:12px; /* smaller */
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:10px;
    overflow:hidden;
  }
  .disc-table th,
  .disc-table td{
    padding:10px 8px;
    border-bottom:1px solid #eef2f7;
    text-align:left;
    vertical-align:middle;
  }
  .disc-table th{
    font-weight:800;
    color:#111;
    background:#f8fafc;
  }
  .disc-table td:last-child,
  .disc-table th:last-child{
    text-align:right;
  }
  .disc-table tr:last-child td{
    border-bottom:none;
  }
  .disc-table select,
  .disc-table input{
    min-width:unset;
    width:100%;
    padding:7px 8px;
    font-size:12px;
  }

  .disc-pill{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:3px 8px;
    border-radius:999px;
    background:#f1f5f9;
    font-weight:800;
    color:#0f172a;
  }
  .disc-calc{
    color:#b91c1c;
    font-weight:800;
    font-variant-numeric:tabular-nums;
  }

  .remove{
    cursor:pointer;
    font-size:18px;
    color:#991b1b;
    line-height:1;
    user-select:none;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:30px;
    height:30px;
    border-radius:10px;
    background:#fff1f2;
    margin-left:8px;
  }
  .remove:hover{ filter:brightness(0.95); }

  .add-discount{
    margin-top:10px;
    padding:10px 14px;
    background:#e5e7eb;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:700;
  }
  .add-discount:hover{ filter:brightness(0.98); }

  .total{
    margin-top:12px;
    font-weight:800;
    display:flex;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
  }

  table.plan{
    width:100%;
    margin-top:14px;
    border-collapse:collapse;
  }
  .plan th,.plan td{
    padding:10px 8px;
    border-bottom:1px solid #eee;
    text-align:center;
    font-size:14px;
  }
  .plan td.amount-cell{ text-align:right; }

  .primary-btn{
    margin-top:32px;
    padding:18px;
    width:100%;
    font-size:16px;
    background:#2563eb;
    color:white;
    border:none;
    border-radius:12px;
    font-weight:800;
  }

  /* fluid */
  @media(max-width:980px){
    .label{ min-width:160px; }
    input,select{ min-width:220px; }
    .money-badge{ min-width:unset; justify-content:flex-start; }
    .disc-table{ font-size:12px; }
  }
</style>
</head>

<body>
<div class="container">

  <h2>1. Enrollment</h2>

  <div class="row">
    <div class="label">Academic Year:</div>
    <select id="academicYear">
      <option value="AY25">AY2025–2026</option>
      <option value="SUM26">Summer 2026</option>
      <option value="AY26">AY2026–2027</option>
    </select>
  </div>

  <div class="radio-row">
    <label><input type="radio" name="studentType" value="new" checked> New Student</label>
    <label><input type="radio" name="studentType" value="current"> Current Student</label>
  </div>

  <div id="studentFields"></div>

  <div class="row">
    <div class="label">First Attendance Date:</div>
    <input type="date" id="attendance">
  </div>

  <div class="row">
    <div class="label">Grade Level:</div>
    <select id="grade">
      <option>SR</option><option>EY1</option><option>EY2</option>
      <option>Y1</option><option>Y2</option><option>Y3</option>
    </select>
  </div>

  <div class="row">
    <div class="label">Payment Plan:</div>
    <select id="plan">
      <option>Annual</option>
      <option>Termly</option>
      <option selected>Monthly</option>
    </select>
  </div>

  <h2>2. Calculating Payment</h2>

  <div class="row">
    <div class="label">Tuition Before Discount:</div>
    <span class="money-badge" id="tuition">0</span>
  </div>

  <div class="discount-box">
    <h3>discount</h3>

    <table class="disc-table" aria-label="discounts table">
      <thead>
        <tr>
          <th style="width:110px;">disc nr</th>
          <th style="width:260px;">type (free | fixed amount | percentage)</th>
          <th style="width:200px;">amount</th>
          <th style="width:220px; text-align:right;">calculated</th>
        </tr>
      </thead>
      <tbody id="discounts"></tbody>
    </table>

    <button type="button" class="add-discount" id="addDiscountBtn">+ add discount</button>
  </div>

  <div class="total">
    <span style="min-width:220px;">Total Discount:</span>
    <span class="money-badge red" id="totalDiscount">0</span>
  </div>
  <div class="total">
    <span style="min-width:220px;">Amount After Discount:</span>
    <span class="money-badge" id="afterDiscount">0</span>
  </div>
  <div class="total">
    <span style="min-width:220px;">Monthly Fee (10x):</span>
    <span class="money-badge" id="monthlyFee">0</span>
  </div>

  <h2>3. Tuition Payment Plan</h2>

  <table class="plan">
    <thead>
      <tr><th>No</th><th>Due Date</th><th style="text-align:right;">Amount</th></tr>
    </thead>
    <tbody id="planBody"></tbody>
  </table>

  <button class="primary-btn">Add Student & Create Payment Plan</button>

  <p style="margin-top:12px;font-size:13px;color:#555">
    By clicking, we will create new student, payment plan, and then go to payment (creating payment receipt) page.
  </p>

</div>

<script>
/* ---------- PRICING (from your inserts) ---------- */
const PRICING = {
  AY25: {
    SR: { Annual: 2700000, Termly: 3000000, Monthly: 3000000 },
    EY1:{ Annual: 3900000, Termly: 4200000, Monthly: 4200000 },
    EY2:{ Annual: 3900000, Termly: 4200000, Monthly: 4200000 },
    Y1: { Annual: 4200000, Termly: 4500000, Monthly: 4500000 },
    Y2: { Annual: 4200000, Termly: 4500000, Monthly: 4500000 },
    Y3: { Annual: 4200000, Termly: 4500000, Monthly: 4500000 }
  },
  AY26: {
    SR: { Annual: 2890000, Termly: 3090000, Monthly: 3290000 },
    EY1:{ Annual: 4290000, Termly: 4490000, Monthly: 4890000 },
    EY2:{ Annual: 4290000, Termly: 4490000, Monthly: 4890000 },
    Y1: { Annual: 4690000, Termly: 4890000, Monthly: 5290000 },
    Y2: { Annual: 4690000, Termly: 4890000, Monthly: 5290000 },
    Y3: { Annual: 4690000, Termly: 4890000, Monthly: 5290000 }
  },
  SUM26: { ALL: { Annual: 850000, Termly: 850000, Monthly: 850000 } }
};

/* ---------- ELEMENTS ---------- */
const elYear = document.getElementById("academicYear");
const elGrade = document.getElementById("grade");
const elPlan = document.getElementById("plan");
const elAttendance = document.getElementById("attendance");
const elStudentFields = document.getElementById("studentFields");

const elDiscountsTbody = document.getElementById("discounts");

const elTuition = document.getElementById("tuition");
const elTotalDiscount = document.getElementById("totalDiscount");
const elAfterDiscount = document.getElementById("afterDiscount");
const elMonthlyFee = document.getElementById("monthlyFee");
const elPlanBody = document.getElementById("planBody");

document.getElementById("addDiscountBtn").addEventListener("click", addDiscount);

/* default attendance = today */
elAttendance.value = new Date().toISOString().slice(0, 10);

/* ---------- STUDENT UI ---------- */
function renderStudent() {
  const type = document.querySelector('input[name="studentType"]:checked').value;
  const year = elYear.value;

  elStudentFields.innerHTML = "";

  if (type === "new") {
    const id = (year === "AY25") ? "PR25142" : "PR26012";
    elStudentFields.innerHTML = `
      <div class="row">
        <div class="label">Student ID:</div>
        <span class="student-id-badge">${id}</span>
      </div>
    `;
  } else {
    elStudentFields.innerHTML = `
      <div class="row">
        <div class="label">Student Name:</div>
        <input type="text" id="curStudentName" placeholder="Student Name">
      </div>
      <div class="row">
        <div class="label">Student ID:</div>
        <input type="text" id="curStudentId" placeholder="Student ID">
      </div>
    `;
  }
}

/* ---------- DISCOUNTS UI ---------- */
let discCounter = 0;

function addDiscount() {
  discCounter += 1;

  const tr = document.createElement("tr");
  tr.className = "disc-tr";
  tr.innerHTML = `
    <td><span class="disc-pill">disc ${discCounter}</span></td>

    <td>
      <select class="disc-type">
        <option value="fixed" selected>fixed amount</option>
        <option value="percent">percentage</option>
        <option value="free">free</option>
      </select>
    </td>

    <td>
      <input class="disc-value" type="number" min="0" placeholder="enter value">
    </td>

    <td style="text-align:right;">
      <span class="disc-calc">0</span>
      <span class="remove" title="Remove" aria-label="Remove">−</span>
    </td>
  `;

  tr.querySelector(".remove").addEventListener("click", () => {
    tr.remove();
    recalc();
  });

  tr.querySelector(".disc-type").addEventListener("change", recalc);
  tr.querySelector(".disc-value").addEventListener("input", recalc);

  elDiscountsTbody.appendChild(tr);
  recalc();
}

/* ---------- CALC ---------- */
function getBaseTuition() {
  const year = elYear.value;
  const grade = elGrade.value;
  const plan = elPlan.value;

  if (year === "SUM26") return PRICING.SUM26.ALL[plan] || 0;
  return (PRICING[year] && PRICING[year][grade] && PRICING[year][grade][plan]) ? PRICING[year][grade][plan] : 0;
}
function fmt(n){ return Math.round(n).toLocaleString(); }

function recalc() {
  const base = getBaseTuition();
  elTuition.textContent = fmt(base);

  // read rows
  const rows = Array.from(elDiscountsTbody.querySelectorAll("tr")).map(tr => {
    const type = tr.querySelector(".disc-type").value;
    const val = Number(tr.querySelector(".disc-value").value || 0);
    return { tr, type, val };
  });

  // rule: fixed first, then percent (free treated as fixed in this UI, value = fixed discount)
  const fixedRows = rows.filter(r => r.type === "fixed" || r.type === "free");
  const percentRows = rows.filter(r => r.type === "percent");

  let running = base;

  // fixed total
  let totalFixed = 0;
  fixedRows.forEach(r => totalFixed += Math.max(0, r.val));
  running = Math.max(0, running - totalFixed);

  // percent computed on remaining
  let totalPercent = 0;
  percentRows.forEach(r => {
    const pct = Math.max(0, r.val);
    totalPercent += (running * pct / 100);
  });

  const totalDiscount = totalFixed + totalPercent;
  const after = Math.max(0, base - totalDiscount);

  // display per-row calculated
  fixedRows.forEach(r => {
    const d = Math.max(0, r.val);
    r.tr.querySelector(".disc-calc").textContent = "-" + fmt(d);
  });

  const percentBase = Math.max(0, base - totalFixed);
  percentRows.forEach(r => {
    const pct = Math.max(0, r.val);
    const d = percentBase * pct / 100;
    r.tr.querySelector(".disc-calc").textContent = (pct ? (pct + "%") : "0") + "  ( -" + fmt(d) + " )";
  });

  // totals
  elTotalDiscount.textContent = "-" + fmt(totalDiscount);
  elAfterDiscount.textContent = fmt(after);
  elMonthlyFee.textContent = fmt(after / 10);

  // plan
  const per = Math.round(after / 10);
  elPlanBody.innerHTML = "";
  for (let i = 1; i <= 10; i++) {
    const due = (i === 1) ? "Registration Date" : ("Month " + i);
    elPlanBody.innerHTML += `
      <tr>
        <td>${i}</td>
        <td>${due}</td>
        <td class="amount-cell"><span class="money-badge">${fmt(per)}</span></td>
      </tr>
    `;
  }
}

/* ---------- EVENTS ---------- */
document.querySelectorAll('input[name="studentType"]').forEach(r =>
  r.addEventListener("change", renderStudent)
);

elYear.addEventListener("change", () => { renderStudent(); recalc(); });
elGrade.addEventListener("change", recalc);
elPlan.addEventListener("change", recalc);

/* init */
renderStudent();
recalc();
</script>
</body>
</html>
