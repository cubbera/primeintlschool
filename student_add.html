<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Create Student Plan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui;
    background: #f5f5f7;
    padding: 30px;
  }

  .container {
    max-width: 860px;
    margin: 0 auto;
    background: #ffffff;
    padding: 24px;
    border-radius: 12px;
  }

  h1 { margin-bottom: 20px; }
  h2 { margin-top: 28px; border-bottom: 2px solid #e5e7eb; padding-bottom: 6px; }

  .step {
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 20px;
  }

  label {
    display: block;
    font-weight: 600;
    margin-top: 12px;
  }

  input, select {
    width: 100%;
    padding: 8px;
    margin-top: 6px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  .radio-group {
    margin-top: 8px;
  }

  .radio-group label {
    font-weight: normal;
    display: inline-flex;
    align-items: center;
    margin-right: 20px;
    gap: 6px;
  }

  .hint {
    margin-top: 10px;
    font-size: 13px;
    color: gray;
  }

  .hint.success { color: green; }

  .two-col {
    display: flex;
    gap: 16px;
  }
  .two-col > div { flex: 1; }

  .discount-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
    padding: 8px 10px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    background: #f9fafb;
  }

  .discount-row select { width: 68%; }
  .discount-amount {
    font-weight: bold;
    color: red;
    width: 30%;
    text-align: right;
  }

  table {
    width: 100%;
    margin-top: 16px;
    border-collapse: collapse;
  }

  table td {
    padding: 6px 4px;
    font-size: 14px;
  }

  table td:nth-child(2) {
    text-align: right;
    font-weight: bold;
  }

  .btn-add {
    margin-top: 10px;
    background: #1d4ed8;
    color: #fff;
    padding: 8px 16px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
  }

  .btn-submit {
    margin-top: 22px;
    width: 100%;
    background: #059669;
    color: #fff;
    font-size: 18px;
    padding: 14px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
  }
</style>
</head>

<body>

<div class="container">
<h1>Create Student Plan</h1>

<!-- ================= STEP 1 ================= -->
<div class="step">
<h3>Step 1 — Enrollment</h3>

<label>Select Enrollment Option:</label>
<select id="enrollFor">
  <option value="">Select…</option>
  <option value="AY25">Academic Year 2025–2026</option>
  <option value="SUM2026">Summer 2026</option>
  <option value="AY26">Academic Year 2026–2027</option>
  <option value="TE">Tiny Explorer (10-weeks)</option>
</select>

<label style="margin-top:20px;">Enroll Type:</label>
<div class="radio-group">
  <label><input type="radio" name="enrollType" value="new" checked> New Student</label>
  <label><input type="radio" name="enrollType" value="current"> Current Student</label>
</div>

<div id="studentFields" style="margin-top:20px;"></div>
</div>

<!-- ================= STEP 2 ================= -->
<h2>2. Enrollment Details</h2>

<label>Academic Year</label>
<select><option>2025–2026</option></select>

<div class="two-col">
<div>
<label>Division</label>
<select id="division" onchange="updateLevels(); autoFillTuition();">
<option value="">Select</option>
<option>Preschool</option>
<option>Primary</option>
</select>
</div>
<div>
<label>Level</label>
<select id="level" onchange="autoFillTuition()"></select>
</div>
</div>

<label>Payment Plan</label>
<select id="paymentPlan" onchange="autoFillTuition(); updatePaymentPlanAuto();">
<option value="">Select</option>
<option>Monthly</option>
<option>Termly</option>
<option>Annual</option>
</select>

<!-- ================= STEP 3 ================= -->
<h2>3. Calculated Tuition Summary</h2>

<label>Tuition Before Discount</label>
<input id="tuitionBefore" onkeyup="updateDiscounts()">

<h3>Add Discounts</h3>
<div id="discountContainer"></div>
<button class="btn-add" onclick="addDiscountRow()">+ Add Discount</button>

<table>
<tr><td>Total Discount</td><td id="totalDiscount">0</td></tr>
<tr><td>After Discount</td><td id="afterDiscount">0</td></tr>
<tr><td>Monthly Fee</td><td id="monthlyFee">0</td></tr>
</table>

<h3>Payment Plan</h3>
<table>
<tr><td>#</td><td>Due Date</td><td>Amount</td></tr>
<tr><td>1</td><td>Registration</td><td class="pp-amount">0</td></tr>
<tr><td>2</td><td>1 July</td><td class="pp-amount">0</td></tr>
<tr><td>3</td><td>1 Aug</td><td class="pp-amount">0</td></tr>
<tr><td>4</td><td>1 Sep</td><td class="pp-amount">0</td></tr>
<tr><td>5</td><td>1 Oct</td><td class="pp-amount">0</td></tr>
<tr><td>6</td><td>1 Nov</td><td class="pp-amount">0</td></tr>
<tr><td>7</td><td>1 Dec</td><td class="pp-amount">0</td></tr>
<tr><td>8</td><td>1 Jan</td><td class="pp-amount">0</td></tr>
<tr><td>9</td><td>1 Feb</td><td class="pp-amount">0</td></tr>
<tr><td>10</td><td>1 Mar</td><td class="pp-amount">0</td></tr>
</table>

<button class="btn-submit">Add Student & Create Tuition Plan</button>
</div>

<script>
const enrollForEl = document.getElementById("enrollFor");
const studentFieldsEl = document.getElementById("studentFields");

function renderStudentFields() {
  const enrollType = document.querySelector("input[name='enrollType']:checked").value;
  const enrollFor = enrollForEl.value;
  studentFieldsEl.innerHTML = enrollType === "new" ? `
    <label>Student Full Name</label><input>
    <label>Father’s Name</label><input>
    ${enrollFor ? `<p class="hint success">Student ID auto-generated (${enrollFor})</p>` : ""}
  ` : `
    <label>Student ID</label><input>
    <p class="hint">System will auto-fetch student</p>
  `;
}
document.querySelectorAll("input[name='enrollType']").forEach(r => r.onchange = renderStudentFields);
enrollForEl.onchange = renderStudentFields;
renderStudentFields();

function updateLevels() {
  level.innerHTML = division.value === "Preschool"
    ? "<option>SR</option><option>EY1</option><option>EY2</option>"
    : "<option>Y1</option><option>Y2</option><option>Y3</option>";
}

function autoFillTuition() {
  if (!division.value || !paymentPlan.value) return;
  tuitionBefore.value =
    division.value === "Preschool"
      ? (paymentPlan.value === "Annual" ? 3900000 : 4200000)
      : (paymentPlan.value === "Annual" ? 4200000 : 4500000);
  updateDiscounts();
}

function addDiscountRow() {
  const row = document.createElement("div");
  row.className = "discount-row";
  row.innerHTML = `
    <select onchange="updateDiscounts()">
      <option value="">Select</option>
      <option value="35">Early Bird 35%</option>
      <option value="15">Play & Learn 15%</option>
      <option value="100000">Referral 100k</option>
    </select>
    <div class="discount-amount">0</div>`;
  discountContainer.appendChild(row);
}

function updateDiscounts() {
  let tuition = +tuitionBefore.value || 0;
  let total = 0;
  document.querySelectorAll(".discount-row").forEach(r => {
    const v = r.querySelector("select").value;
    let d = v === "100000" ? 100000 : tuition * (v / 100 || 0);
    r.querySelector(".discount-amount").textContent = d ? "-" + d.toLocaleString() : "0";
    total += d;
  });
  totalDiscount.textContent = "-" + total.toLocaleString();
  afterDiscount.textContent = (tuition - total).toLocaleString();
  monthlyFee.textContent = Math.round((tuition - total) / 10).toLocaleString();
  updatePaymentPlanAuto();
}

function updatePaymentPlanAuto() {
  const net = +afterDiscount.textContent.replace(/,/g,"") || 0;
  let count = paymentPlan.value === "Annual" ? 1 : paymentPlan.value === "Termly" ? 3 : 10;
  const per = Math.round(net / count);
  document.querySelectorAll(".pp-amount").forEach((c,i)=>c.textContent=i<count?per.toLocaleString():"");
}
</script>

</body>
</html>
