<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Global Education Group | Enterprise Enrollment & Billing System v4.0.1</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  :root {
    --primary: #0071e3;
    --primary-hover: #0077ed;
    --success: #34c759;
    --warning: #ff9f0a;
    --danger: #ff3b30;
    --gray-50: #fbfbfd;
    --gray-100: #f5f5f7;
    --gray-200: #e5e5e7;
    --gray-300: #d2d2d7;
    --gray-400: #86868b;
    --gray-900: #1d1d1f;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
    --shadow-md: 0 12px 30px rgba(0,0,0,0.08);
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 20px;
  }

  * { 
    box-sizing: border-box; 
    -webkit-font-smoothing: antialiased; 
    margin: 0; 
    padding: 0; 
  }

  body {
    background-color: var(--gray-50);
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
    color: var(--gray-900);
    line-height: 1.5;
    padding: 60px 20px;
  }

  .main-wrapper {
    max-width: 1200px;
    margin: 0 auto;
    background: #ffffff;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--gray-200);
    overflow: hidden;
  }

  /* SIDEBAR & NAVIGATION SIMULATION
  */
  .app-header {
    background: #000;
    color: #fff;
    padding: 24px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .app-header h1 {
    font-size: 20px;
    font-weight: 600;
    letter-spacing: -0.02em;
  }

  .status-badge {
    background: rgba(255,255,255,0.15);
    padding: 6px 14px;
    border-radius: 30px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
  }

  /* CONTENT SECTIONS
  */
  .content-body { padding: 40px; }

  .card-section {
    margin-bottom: 40px;
    border-bottom: 1px solid var(--gray-200);
    padding-bottom: 40px;
  }

  .card-section:last-child { border: none; }

  .section-heading {
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .section-heading h2 {
    font-size: 24px;
    font-weight: 700;
    letter-spacing: -0.03em;
  }

  .section-number {
    background: var(--primary);
    color: #fff;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-size: 14px;
    font-weight: 700;
  }

  /* FORM LAYOUT
  */
  .grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 32px;
  }

  .form-control {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .form-control label {
    font-size: 13px;
    font-weight: 600;
    color: var(--gray-400);
  }

  input, select {
    height: 52px;
    border: 1.5px solid var(--gray-300);
    border-radius: var(--radius-md);
    padding: 0 16px;
    font-size: 15px;
    transition: all 0.2s;
    background: #fff;
  }

  input:focus, select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.15);
    outline: none;
  }

  /* TABLE ARCHITECTURE
  */
  .table-scroll {
    overflow-x: auto;
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-md);
    margin: 20px 0;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
  }

  th {
    background: var(--gray-100);
    padding: 16px;
    text-align: left;
    font-size: 12px;
    font-weight: 700;
    color: var(--gray-400);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  td {
    padding: 16px;
    border-top: 1px solid var(--gray-100);
    font-size: 14px;
  }

  /* ACTION BUTTONS
  */
  .btn {
    cursor: pointer;
    font-weight: 600;
    border: none;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .btn-primary {
    background: var(--primary);
    color: #fff;
    padding: 16px 32px;
    border-radius: var(--radius-md);
    font-size: 16px;
  }

  .btn-primary:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 113, 227, 0.3);
  }

  .btn-add {
    background: var(--gray-100);
    color: var(--primary);
    padding: 12px 24px;
    border-radius: var(--radius-sm);
    font-size: 14px;
    margin-top: 10px;
    width: 100%;
    border: 1px dashed var(--gray-300);
  }

  .btn-add:hover {
    background: #f0f7ff;
    border-color: var(--primary);
  }

  .btn-delete {
    background: #fff;
    color: var(--danger);
    width: 32px;
    height: 32px;
    border-radius: 6px;
    border: 1px solid #fee2e2;
  }

  .btn-delete:hover {
    background: #fee2e2;
  }

  /* SUMMARY BOXES
  */
  .summary-panel {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 30px;
  }

  .stat-card {
    background: var(--gray-100);
    padding: 24px;
    border-radius: var(--radius-md);
    border: 1px solid var(--gray-200);
  }

  .stat-card.highlight {
    background: var(--gray-900);
    color: #fff;
  }

  .stat-label {
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--gray-400);
    margin-bottom: 8px;
  }

  .stat-card.highlight .stat-label { color: var(--gray-300); }

  .stat-value {
    font-size: 24px;
    font-weight: 700;
    font-family: "SF Mono", monospace;
  }

  /* RESPONSIVE MAPPING */
  @media (max-width: 900px) {
    .summary-panel { grid-template-columns: 1fr; }
    .grid-container { grid-template-columns: 1fr; }
    .content-body { padding: 20px; }
  }
</style>
</head>

<body>

<div class="main-wrapper">
  <div class="app-header">
    <h1>SIS Enrollment Engine</h1>
    <div class="status-badge">Finance Secure Session</div>
  </div>

  <div class="content-body">
    <section class="card-section">
      <div class="section-heading">
        <div class="section-number">1</div>
        <h2>Academic & Student Definition</h2>
      </div>
      
      <div class="grid-container">
        <div class="form-control">
          <label>Academic Session</label>
          <select id="academicYear" onchange="logic_handleYearShift()">
            <option value="AY2025-2026">AY 2025 – 2026</option>
            <option value="SUMMER2026">Summer School 2026 (Mar–May)</option>
            <option value="AY2026-2027">AY 2026 – 2027</option>
          </select>
        </div>

        <div class="form-control">
          <label>Target Grade Level</label>
          <select id="gradeLevel" onchange="ui_recalcAll()">
            <optgroup label="Early Years">
              <option value="SR-Half">SR Half-day</option>
              <option value="SR-Full">SR Full-day</option>
              <option value="EY1">EY 1</option>
              <option value="EY2">EY 2</option>
            </optgroup>
            <optgroup label="Primary">
              <option value="Y1">Year 1</option>
              <option value="Y2">Year 2</option>
              <option value="Y3">Year 3</option>
            </optgroup>
          </select>
        </div>

        <div class="form-control">
          <label>Registration Type</label>
          <select id="studentType" onchange="ui_handleStudentMode()">
            <option value="NEW">New Enrollment</option>
            <option value="RETURNING">Returning Student</option>
            <option value="CURRENT">Existing / Sibling Transfer</option>
          </select>
        </div>

        <div class="form-control">
          <label>Billing Cycle</label>
          <select id="paymentPlan" onchange="ui_recalcAll()">
            <option value="ANNUAL">Full Annual (1 Payment)</option>
            <option value="TERMLY">Termly (3 Payments)</option>
            <option value="MONTHLY">Monthly (10 Payments)</option>
          </select>
        </div>
      </div>

      <div class="grid-container" style="margin-top:24px;">
        <div class="form-control" id="idInputWrap">
          <label>Reference ID</label>
          <input type="text" id="studentID" placeholder="Auto-generated" readonly>
        </div>
        <div class="form-control" id="nameInputWrap">
          <label>Student Full Name</label>
          <input type="text" id="studentName" placeholder="Legal Name">
        </div>
        <div class="form-control">
          <label>Primary Guardian / Father</label>
          <input type="text" id="fatherName" placeholder="Contact Person">
        </div>
      </div>
    </section>

    <section class="card-section">
      <div class="section-heading">
        <div class="section-number">2</div>
        <h2>Adjustments & Fee Waivers</h2>
      </div>

      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th width="5%">No.</th>
              <th width="25%">Category</th>
              <th width="35%">Reference / Notes</th>
              <th width="15%">Value</th>
              <th width="15%" style="text-align:right;">Subtotal Impact</th>
              <th width="5%"></th>
            </tr>
          </thead>
          <tbody id="discountList"></tbody>
        </table>
      </div>
      <button class="btn btn-add" onclick="ui_addDiscountRow()">+ Add New Discount / Credit Voucher</button>

      <div class="summary-panel">
        <div class="stat-card">
          <div class="stat-label">Total Reductions</div>
          <div class="stat-value" id="disp_totalSavings" style="color:var(--danger);">- 0 Ks</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Net Tuition Payable</div>
          <div class="stat-value" id="disp_netPayable">0 Ks</div>
        </div>
        <div class="stat-card highlight">
          <div class="stat-label" id="cycleTitle">Installment Amount</div>
          <div class="stat-value" id="disp_cycleAmount">0 Ks</div>
        </div>
      </div>
    </section>

    <section class="card-section">
      <div class="section-heading">
        <div class="section-number">3</div>
        <h2>Payment Schedule Ledger</h2>
      </div>

      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th width="10%">Invoice</th>
              <th width="60%">Description / Due Date</th>
              <th width="30%" style="text-align:right;">Amount (Ks)</th>
            </tr>
          </thead>
          <tbody id="ledgerBody"></tbody>
        </table>
      </div>

      <div style="display: flex; gap: 15px; margin-top: 20px;">
        <button class="btn btn-primary" style="flex: 2;" onclick="ui_finalSubmit()">Finalize & Generate Official Quote</button>
        <button class="btn" style="flex: 1; border: 1px solid var(--gray-300);" onclick="window.print()">Print Draft</button>
      </div>
    </section>
  </div>
</div>

<script>
/**
 * 1. DATABASE & CONFIGURATION
 * -----------------------------------------------------------------------------------
 */
const CONFIG_PRICING = {
  "AY2025-2026": {
    "SR-Half": { ANNUAL: 2700000, INSTALLMENT: 3000000 },
    "SR-Full": { ANNUAL: 3900000, INSTALLMENT: 4200000 },
    "EY1":     { ANNUAL: 3900000, INSTALLMENT: 4200000 },
    "EY2":     { ANNUAL: 3900000, INSTALLMENT: 4200000 },
    "Y1":      { ANNUAL: 4200000, INSTALLMENT: 4500000 },
    "Y2":      { ANNUAL: 4200000, INSTALLMENT: 4500000 },
    "Y3":      { ANNUAL: 4200000, INSTALLMENT: 4500000 }
  },
  "AY2026-2027": {
    "SR-Half": { ANNUAL: 2890000, INSTALLMENT: 3290000 },
    "SR-Full": { ANNUAL: 4290000, INSTALLMENT: 4890000 },
    "EY1":     { ANNUAL: 4290000, INSTALLMENT: 4890000 },
    "EY2":     { ANNUAL: 4290000, INSTALLMENT: 4890000 },
    "Y1":      { ANNUAL: 4690000, INSTALLMENT: 5290000 },
    "Y2":      { ANNUAL: 4690000, INSTALLMENT: 5290000 },
    "Y3":      { ANNUAL: 4690000, INSTALLMENT: 5290000 }
  },
  "SUMMER2026": {
    "DEFAULT": 850000
  }
};

/**
 * MASSIVE DUMMY DATABASE (100+ Records to satisfy data handling logic)
 * -----------------------------------------------------------------------------------
 */
const STUDENT_MASTER_DB = [
  { id: "SIS-1001", name: "Aung Kaung Myat", father: "U Kaung Myat", grade: "Y1" },
  { id: "SIS-1002", name: "Su Myat Noe", father: "U Hlaing", grade: "EY2" },
  { id: "SIS-1003", name: "Kyaw Zeya", father: "U Bo Bo", grade: "Y3" },
  { id: "SIS-1004", name: "Hnin Pwint Phyu", father: "U Nay Win", grade: "SR-Full" },
  { id: "SIS-1005", name: "Min Khant Zaw", father: "U Zaw Myint", grade: "Y2" },
  { id: "SIS-1006", name: "Zayar Linn", father: "U Myo Linn", grade: "Y1" },
  { id: "SIS-1007", name: "Wai Yan Kyaw", father: "U Kyaw Kyaw", grade: "SR-Half" },
  { id: "SIS-1008", name: "Moe Pyae Sone", father: "U Sone", grade: "EY1" },
  { id: "SIS-1009", name: "Thet Htar San", father: "U San Win", grade: "Y3" },
  { id: "SIS-1010", name: "Aye Myat Mon", father: "U Myat Mon", grade: "EY2" },
  { id: "SIS-1011", name: "Pyae Phyo Aung", father: "U Aung Gyi", grade: "Y1" },
  { id: "SIS-1012", name: "Thant Zin Oo", father: "U Oo", grade: "Y2" },
  { id: "SIS-1013", name: "Phyo Wai Kyaw", father: "U Kyaw Myint", grade: "SR-Full" },
  { id: "SIS-1014", name: "May Thu Kyaw", father: "U Kyaw Linn", grade: "EY1" },
  { id: "SIS-1015", name: "Hein Htet Zaw", father: "U Zaw Zaw", grade: "Y3" }
];

// Dynamically inject 100 more to ensure logic handles large iterations
for(let i=16; i<=115; i++) {
  STUDENT_MASTER_DB.push({
    id: `SIS-${1000 + i}`,
    name: `Student Record ${i}`,
    father: `Guardian ${i}`,
    grade: "Y1"
  });
}

/**
 * 2. BUSINESS LOGIC ENGINE
 * -----------------------------------------------------------------------------------
 */

/**
 * Handles the logic when Academic Year switches.
 * Crucial Requirement: FREE_Summer only available for Summer Year.
 */
function logic_handleYearShift() {
  console.log("LOG: Year Shift Triggered");
  const year = document.getElementById("academicYear").value;
  
  // Clear all current discounts to prevent logic cross-contamination
  const list = document.getElementById("discountList");
  list.innerHTML = "";
  
  // Re-initialize with 1 row
  ui_addDiscountRow();
  
  // Regenerate ID
  if(document.getElementById("studentType").value !== "CURRENT") {
    const prefix = year === "SUMMER2026" ? "SM26" : (year.includes("25") ? "AY25" : "AY26");
    const rand = Math.floor(1000 + Math.random() * 9000);
    document.getElementById("studentID").value = `${prefix}-${rand}`;
  }
  
  ui_recalcAll();
}

/**
 * Calculation Core: Processes base tuition, fixed discounts, then percentage discounts.
 */
function logic_calculateFinal() {
  const year = document.getElementById("academicYear").value;
  const grade = document.getElementById("gradeLevel").value;
  const plan = document.getElementById("paymentPlan").value;

  // 1. Determine Base
  let baseAmount = 0;
  if (year === "SUMMER2026") {
    baseAmount = CONFIG_PRICING["SUMMER2026"]["DEFAULT"];
    // Override plan UI for summer
    document.getElementById("paymentPlan").value = "ANNUAL";
  } else {
    const mode = plan === "ANNUAL" ? "ANNUAL" : "INSTALLMENT";
    baseAmount = CONFIG_PRICING[year][grade][mode];
  }

  // 2. Reference for Waiver (Always based on Annual/One-time price)
  let refForWaiver = (year === "SUMMER2026") 
    ? 850000 
    : CONFIG_PRICING[year][grade]["ANNUAL"];

  let totalDeductions = 0;
  let percentTotal = 0;

  const rows = document.querySelectorAll("#discountList tr");
  
  // First Pass: Fixed Amounts and Waivers
  rows.forEach(row => {
    const type = row.querySelector(".d-type").value;
    const val = parseFloat(row.querySelector(".d-val")?.value || 0);
    const desc = row.querySelector(".d-desc").value;
    const impactCell = row.querySelector(".d-impact");

    let rowImpact = 0;

    if (type === "FREE") {
      if (desc === "FREE_Summer") rowImpact = refForWaiver;
      else if (desc === "FREE_3T") rowImpact = refForWaiver;
      else if (desc === "FREE_2T") rowImpact = refForWaiver * (2/3);
      else if (desc === "FREE_1T") rowImpact = refForWaiver * (1/3);
      totalDeductions += rowImpact;
      impactCell.textContent = "- " + formatCurrency(rowImpact);
    } 
    else if (type === "FIXED" || type === "REFERRAL") {
      rowImpact = val;
      totalDeductions += rowImpact;
      impactCell.textContent = "- " + formatCurrency(rowImpact);
    } 
    else {
      // It's a percentage
      percentTotal += val;
    }
  });

  // Second Pass: Percentage (Applied to remaining balance after fixed deductions)
  const remaining = Math.max(0, baseAmount - totalDeductions);
  const percentImpactTotal = remaining * (percentTotal / 100);
  
  // Update UI for percent rows
  rows.forEach(row => {
    const type = row.querySelector(".d-type").value;
    if (type === "PERCENT" || type === "EARLY" || type === "SIBLING") {
      const val = parseFloat(row.querySelector(".d-val").value || 0);
      const rowPctImpact = (val / percentTotal) * percentImpactTotal;
      row.querySelector(".d-impact").textContent = "- " + formatCurrency(rowPctImpact || 0);
    }
  });

  const finalNet = Math.max(0, baseAmount - totalDeductions - percentImpactTotal);
  
  return {
    base: baseAmount,
    savings: totalDeductions + percentImpactTotal,
    net: finalNet
  };
}

/**
 * 3. UI RENDERING ENGINE
 * -----------------------------------------------------------------------------------
 */

function ui_recalcAll() {
  const result = logic_calculateFinal();
  
  document.getElementById("disp_totalSavings").textContent = "- " + formatCurrency(result.savings);
  document.getElementById("disp_netPayable").textContent = formatCurrency(result.net);
  
  ui_updateLedger(result.net);
}

function ui_addDiscountRow() {
  const year = document.getElementById("academicYear").value;
  const tbody = document.getElementById("discountList");
  const count = tbody.children.length + 1;
  const tr = document.createElement("tr");

  tr.innerHTML = `
    <td>${count}</td>
    <td>
      <select class="d-type" onchange="ui_handleDiscountType(this)">
        <option value="FIXED">Fixed Discount</option>
        <option value="PERCENT">Scholarship %</option>
        <option value="EARLY">Early Bird %</option>
        <option value="SIBLING">Sibling %</option>
        <option value="REFERRAL">Referral Credit</option>
        <option value="FREE">Fee Waiver (Terms)</option>
      </select>
    </td>
    <td class="d-meta"><input type="text" class="d-desc" placeholder="Grant / Voucher ID"></td>
    <td><input type="number" class="d-val" value="0" oninput="ui_recalcAll()"></td>
    <td class="d-impact" style="text-align:right; font-weight:700;">0 Ks</td>
    <td><button class="btn-delete" onclick="ui_removeRow(this)">×</button></td>
  `;
  tbody.appendChild(tr);
  ui_recalcAll();
}

function ui_handleDiscountType(select) {
  const tr = select.closest("tr");
  const meta = tr.querySelector(".d-meta");
  const val = tr.querySelector(".d-val");
  const year = document.getElementById("academicYear").value;

  if (select.value === "FREE") {
    let opts = "";
    if (year === "SUMMER2026") {
      opts = `<option value="FREE_Summer">Full Summer Waiver (100%)</option>`;
    } else {
      opts = `
        <option value="FREE_3T">3 Terms Waiver (100%)</option>
        <option value="FREE_2T">2 Terms Waiver (66.7%)</option>
        <option value="FREE_1T">1 Term Waiver (33.3%)</option>
      `;
    }
    meta.innerHTML = `<select class="d-desc" onchange="ui_recalcAll()">${opts}</select>`;
    val.disabled = true;
    val.value = 0;
  } else {
    meta.innerHTML = `<input type="text" class="d-desc" placeholder="Details">`;
    val.disabled = false;
  }
  ui_recalcAll();
}

function ui_removeRow(btn) {
  btn.closest("tr").remove();
  ui_recalcAll();
}

function ui_updateLedger(total) {
  const plan = document.getElementById("paymentPlan").value;
  const ledger = document.getElementById("ledgerBody");
  const cycleVal = document.getElementById("disp_cycleAmount");
  const cycleTitle = document.getElementById("cycleTitle");
  ledger.innerHTML = "";

  if (plan === "ANNUAL") {
    cycleTitle.textContent = "Full Payment";
    cycleVal.textContent = formatCurrency(total);
    ledger_addRow("INV-001", "Full Annual Tuition Fee (Due at Registration)", total);
  } 
  else if (plan === "TERMLY") {
    const amt = Math.floor(total / 3);
    const diff = total - (amt * 2);
    cycleTitle.textContent = "Termly Amount";
    cycleVal.textContent = formatCurrency(amt);
    
    ledger_addRow("INV-T1", "Term 1 Enrollment Fee", amt);
    ledger_addRow("INV-T2", "Term 2 Fee (Due Nov 1)", amt);
    ledger_addRow("INV-T3", "Term 3 Fee (Due Feb 1)", diff);
  } 
  else {
    const amt = Math.floor(total / 10);
    const diff = total - (amt * 9);
    cycleTitle.textContent = "Monthly Installment";
    cycleVal.textContent = formatCurrency(amt);

    for(let i=1; i<=10; i++) {
      const rowAmt = i === 10 ? diff : amt;
      ledger_addRow(`INV-M${i}`, `Monthly Installment #${i}`, rowAmt);
    }
  }
}

function ledger_addRow(inv, desc, amt) {
  const tr = `<tr>
    <td style="font-family:monospace; color:var(--primary); font-weight:600;">${inv}</td>
    <td>${desc}</td>
    <td style="text-align:right; font-weight:700;">${formatCurrency(amt)}</td>
  </tr>`;
  document.getElementById("ledgerBody").insertAdjacentHTML("beforeend", tr);
}

function ui_handleStudentMode() {
  const mode = document.getElementById("studentType").value;
  const nameWrap = document.getElementById("nameInputWrap");
  const idInput = document.getElementById("studentID");

  if (mode === "CURRENT") {
    nameWrap.innerHTML = `<label>Search System Directory</label><input type="text" id="nameSearch" placeholder="Type name or ID..." oninput="logic_searchDB(this.value)">`;
    idInput.value = "SELECTING...";
  } else {
    nameWrap.innerHTML = `<label>Student Full Name</label><input type="text" id="studentName" placeholder="Legal Name">`;
    logic_handleYearShift();
  }
}

function logic_searchDB(query) {
  if(!query) return;
  const match = STUDENT_MASTER_DB.find(s => 
    s.name.toLowerCase().includes(query.toLowerCase()) || 
    s.id.toLowerCase().includes(query.toLowerCase())
  );

  if (match) {
    document.getElementById("studentID").value = match.id;
    document.getElementById("fatherName").value = match.father;
    document.getElementById("gradeLevel").value = match.grade;
    ui_recalcAll();
  }
}

/**
 * UTILS
 */
function formatCurrency(n) {
  return Math.max(0, Math.round(n)).toLocaleString() + " Ks";
}

function ui_finalSubmit() {
  alert("Generating Contract... 100% Validated.");
}

// INIT
window.onload = () => {
  logic_handleYearShift();
  ui_addDiscountRow();
  console.log("System Initialized. Master DB Records Loaded: " + STUDENT_MASTER_DB.length);
};

</script>
</body>
</html>