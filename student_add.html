<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Student & Create Tuition Plan</title>

<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, Arial;
        background: #f3f4f6;
        padding: 30px;
    }

    .container {
        max-width: 860px;
        margin: auto;
        background: #fff;
        padding: 28px;
        border-radius: 14px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }

    h1 { margin-top: 0; }
    h2 {
        margin-top: 28px;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 6px;
        font-size: 18px;
    }

    label {
        display: block;
        font-weight: 600;
        margin-top: 12px;
    }

    input, select {
        width: 100%;
        padding: 10px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        margin-bottom: 6px;
        font-size: 14px;
    }

    .two-col {
        display: flex;
        gap: 16px;
    }

    .discount-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 8px;
        padding: 8px 10px;
        background: #f9fafb;
        border-radius: 8px;
    }

    .discount-row select { width: 68%; }
    .discount-amount {
        font-weight: 600;
        color: #dc2626;
        text-align: right;
        width: 30%;
    }

    table {
        width: 100%;
        margin-top: 16px;
        border-collapse: collapse;
        font-size: 14px;
    }

    table td {
        padding: 6px 4px;
    }

    table td:nth-child(2) {
        text-align: right;
        font-weight: 600;
    }

    .btn-add {
        margin-top: 10px;
        background: #2563eb;
        color: #fff;
        padding: 8px 16px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
    }

    .btn-submit {
        margin-top: 22px;
        width: 100%;
        background: #059669;
        color: #fff;
        font-size: 18px;
        padding: 14px;
        border-radius: 10px;
        border: none;
        font-weight: bold;
    }
</style>

<script>
function autoFillTuition() {
    const division = divisionEl.value;
    const level = levelEl.value;
    const plan = paymentPlanEl.value;
    if (!division || !level || !plan) return;

    let amount = 0;
    if (division === "Preschool") {
        amount = plan === "Annual" ? 3900000 : 4200000;
    } else {
        amount = plan === "Annual" ? 4200000 : 4500000;
    }

    tuitionBeforeEl.value = amount;
    updateDiscounts();
}

function addDiscountRow() {
    const row = document.createElement("div");
    row.className = "discount-row";
    row.innerHTML = `
        <select onchange="updateDiscounts()">
            <option value="">-- Select Discount --</option>
            <option value="early35">Early Bird 35%</option>
            <option value="play15">Play & Learn 15%</option>
            <option value="ref100">Referral -100,000 MMK</option>
            <option value="sib5">Sibling 5%</option>
            <option value="sib10">Sibling 10%</option>
        </select>
        <div class="discount-amount">0</div>
    `;
    discountContainer.appendChild(row);
}

function updateDiscounts() {
    const tuition = Number(tuitionBeforeEl.value || 0);
    let totalDiscount = 0;

    document.querySelectorAll(".discount-row").forEach(row => {
        const type = row.querySelector("select").value;
        let d = 0;
        if (type === "early35") d = tuition * 0.35;
        if (type === "play15") d = tuition * 0.15;
        if (type === "ref100") d = 100000;
        if (type === "sib5") d = tuition * 0.05;
        if (type === "sib10") d = tuition * 0.10;

        d = Math.round(d);
        row.querySelector(".discount-amount").textContent = d ? "-" + d.toLocaleString() : "0";
        totalDiscount += d;
    });

    const net = tuition - totalDiscount;
    totalDiscountEl.textContent = "-" + totalDiscount.toLocaleString();
    afterDiscountEl.textContent = net.toLocaleString();

    updatePaymentPlan(net);
}

function updatePaymentPlan(net) {
    const plan = paymentPlanEl.value;
    if (!plan) return;

    let count = plan === "Monthly" ? 10 : plan === "Termly" ? 3 : 1;
    paymentTitle.textContent = `Payment Plan (${plan})`;

    const amount = Math.round(net / count);
    const labels = [
        "Registration Date",
        "1 July","1 August","1 September","1 October",
        "1 November","1 December","1 January","1 February","1 March"
    ];

    paymentPlanBody.innerHTML = "";
    for (let i = 0; i < count; i++) {
        paymentPlanBody.innerHTML += `
            <tr>
                <td style="text-align:center;">${i+1}</td>
                <td style="text-align:center;">${labels[i]}</td>
                <td style="text-align:right;">${amount.toLocaleString()}</td>
            </tr>
        `;
    }
}

function updateLevels() {
    levelEl.innerHTML = "";
    if (divisionEl.value === "Preschool") {
        levelEl.innerHTML += `<option value="SR">SR</option><option value="EY1">EY1</option><option value="EY2">EY2</option>`;
    } else if (divisionEl.value === "Primary") {
        levelEl.innerHTML += `<option value="Y1">Y1</option><option value="Y2">Y2</option><option value="Y3">Y3</option>`;
    }
}

const divisionEl = document.getElementById("division");
const levelEl = document.getElementById("level");
const paymentPlanEl = document.getElementById("paymentPlan");
const tuitionBeforeEl = document.getElementById("tuitionBefore");
const discountContainer = document.getElementById("discountContainer");
const totalDiscountEl = document.getElementById("totalDiscount");
const afterDiscountEl = document.getElementById("afterDiscount");
const paymentPlanBody = document.getElementById("paymentPlanBody");
const paymentTitle = document.getElementById("paymentTitle");
</script>
</head>

<body>
<div class="container">

<h1>Add New Student</h1>

<h2>1. Student Information</h2>
<label>Full Name</label><input>
<label>Father's Name</label><input>

<div class="two-col">
  <div><label>Gender</label><select><option>Male</option><option>Female</option></select></div>
  <div><label>Date of Birth</label><input type="date"></div>
</div>

<h2>2. Enrollment</h2>
<label>Academic Year</label><select><option>2025â€“2026</option></select>

<div class="two-col">
  <div><label>Division</label><select id="division" onchange="updateLevels();autoFillTuition()"><option></option><option>Preschool</option><option>Primary</option></select></div>
  <div><label>Level</label><select id="level" onchange="autoFillTuition()"></select></div>
</div>

<label>Payment Plan</label>
<select id="paymentPlan" onchange="autoFillTuition()">
  <option></option><option>Monthly</option><option>Termly</option><option>Annual</option>
</select>

<h2>3. Calculated Tuition Summary</h2>
<label>Tuition Before Discount</label>
<input id="tuitionBefore" oninput="updateDiscounts()">

<h3>Add Discounts</h3>
<div id="discountContainer"></div>
<button class="btn-add" onclick="addDiscountRow()">+ Add Discount</button>

<table>
<tr><td>Total Discount</td><td id="totalDiscount">0</td></tr>
<tr><td>After Discount</td><td id="afterDiscount">0</td></tr>
</table>

<div style="margin-top:30px;">
<h3 id="paymentTitle">Payment Plan</h3>
<table>
<thead>
<tr><th style="text-align:center;">Month #</th><th style="text-align:center;">Due Date</th><th style="text-align:right;">Amount</th></tr>
</thead>
<tbody id="paymentPlanBody"></tbody>
</table>
</div>

<button class="btn-submit">Add Student & Create Tuition Plan</button>
</div>
</body>
</html>
