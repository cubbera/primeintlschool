<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dynamic Assessment Entry – Year 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SheetJS for Excel import/export -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui;
    background: #f5f5f7;
    padding: 20px;
  }

  .title {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 20px;
  }

  .card {
    background: #ffffff;
    border-radius: 14px;
    padding: 20px;
    border: 1px solid #ddd;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    position: relative;
  }

  .top-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }

  .btn-top {
    padding: 6px 12px;
    background: #0071e3;
    color: white;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 13px;
  }

  .btn-top:hover {
    background: #005bbd;
  }

  .cw-group {
    border: 1px solid #d0d0d5;
    background: #fafafa;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 14px;
    display: inline-block;
  }

  .cw-title {
    font-weight: 600;
    margin-bottom: 6px;
  }

  .cw-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .btn {
    padding: 5px 12px;
    border-radius: 999px;
    border: 1px solid #ccc;
    background: white;
    cursor: pointer;
    font-size: 12px;
  }

  .btn:hover {
    background: #eaeaea;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    margin-top: 15px;
    font-size: 13px;
    min-width: 950px;
  }

  th, td {
    border: 1px solid #dcdcdc;
    padding: 6px;
    text-align: center;
  }

  th {
    background: #f2f2f7;
    font-weight: 600;
  }

  .label-col {
    text-align: left;
    padding-left: 8px;
    font-weight: 600;
    white-space: nowrap;
  }

  input.score-box {
    width: 55px;
    padding: 4px;
    border-radius: 6px;
    border: 1px solid #cfcfd4;
    text-align: right;
  }

  input.name-box {
    width: 150px;
    padding: 4px;
    border-radius: 6px;
    border: 1px solid #cfcfd4;
  }

  .delete-col-btn {
    font-size: 11px;
    background: none;
    border: none;
    color: red;
    cursor: pointer;
    margin-left: 4px;
  }

  .btn-add-student {
    margin-top: 14px;
    padding: 6px 14px;
    border-radius: 999px;
    background: #0071e3;
    color: #fff;
    border: none;
    cursor: pointer;
    font-size: 13px;
  }

  .cw-cell {
    background: #eaf4ff;
  }

  .cw-total-cell {
    background: #eaf4ff;
    font-weight: 600;
  }

  .exam-cell {
    background: #fff8dc;
  }

  .exam-total-cell {
    background: #fff8dc;
    font-weight: 600;
  }

  .total-cell {
    background: #eaffea;
    font-weight: 600;
  }

  .btn-submit {
    margin-top: 20px;
    padding: 10px 20px;
    border-radius: 999px;
    border: none;
    font-size: 14px;
    cursor: pointer;
    background: #28c76f;
    color: #fff;
    display: inline-block;
  }

  .btn-submit:hover {
    background: #20b764;
  }
</style>
</head>

<body>

<div class="title">Assessment Entry – Year 1 (Dynamic Coursework & Exam)</div>

<div class="card">

  <div class="top-buttons">
    <button class="btn-top" onclick="importExcel()">Import from Excel</button>
    <button class="btn-top" onclick="exportExcel()">Export to Excel</button>
  </div>

  <div class="cw-group">
    <div class="cw-title">Coursework Weight: 40%</div>
    <div class="cw-buttons">
      <button class="btn" onclick="addUnitTest()">+ Add Unit Test</button>
      <button class="btn" onclick="addProject()">+ Add Project</button>
      <button class="btn" onclick="addPresentation()">+ Add Presentation</button>
    </div>
  </div>

  <table id="assessmentTable">
    <thead>
      <tr id="headerRow1">
        <th rowspan="2">Nr.</th>
        <th rowspan="2">Student Name</th>
        <th colspan="2" id="cwHeader">Coursework (40%)</th>
        <th colspan="2" id="examHeader">Term Exam (60%)</th>
        <th rowspan="2">Total (100%)</th>
      </tr>
      <tr id="headerRow2">
        <th id="cw-ut1" data-role="cw-col">
          Unit Test 1
          <button class="delete-col-btn" onclick="deleteColumn('cw-ut1')">x</button>
        </th>
        <th data-role="cw-total">Coursework Total (40%)</th>
        <th data-role="exam-score">Exam Score</th>
        <th data-role="exam-total">Exam Total (60%)</th>
      </tr>
    </thead>

    <tbody id="tbody">

<!-- ALL 17 STUDENTS, EXAM = 0 -->

<tr><td>1</td><td class="label-col">Ye Yint Tayza Hman</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>2</td><td class="label-col">Shoon La Woon Htet</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>3</td><td class="label-col">Htun Lae Yi Mon</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>4</td><td class="label-col">Lwin Aung Hein</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>5</td><td class="label-col">Aung Bhone San</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>6</td><td class="label-col">Htet Nay Bhone</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>7</td><td class="label-col">Sian Vang Huai Kim</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>8</td><td class="label-col">Thu Htet Htoo</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>9</td><td class="label-col">Khant Su Thar</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>10</td><td class="label-col">Lwin Khit</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>11</td><td class="label-col">Htut Myat Aung</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>12</td><td class="label-col">Myat Shwe Yee Thin</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>13</td><td class="label-col">Kaung Khit Han</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>14</td><td class="label-col">Linn Pyae Sone Aung</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>15</td><td class="label-col">Sai Noon Wan Han</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>16</td><td class="label-col">Ngwe Yati Moe</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

<tr><td>17</td><td class="label-col">Khant Htet Zan</td><td class="cw-cell" data-col="cw-ut1"><input class="score-box" oninput="recalc()"></td><td class="cw-total-cell">0.00</td><td class="exam-cell exam-score-cell"><input class="score-box" value="0" oninput="recalc()"></td><td class="exam-cell exam-total-cell">0.00</td><td class="total-cell final-total-cell">0.00</td></tr>

    </tbody>
  </table>

  <button class="btn-add-student" onclick="addStudent()">+ Add Student</button>
  <br>
  <button class="btn-submit" onclick="submitScores()">Submit Scores</button>

</div>

<script>
let cwColumns = ["cw-ut1"];

function updateHeaderSpans() {
  document.getElementById("cwHeader").colSpan = cwColumns.length + 1;
}

function addUnitTest() {
  let i = cwColumns.filter(x=>x.startsWith("cw-ut")).length + 1;
  let id = "cw-ut" + i;
  cwColumns.push(id);
  addCourseworkColumn(id, "Unit Test " + i);
}

function addProject() {
  let i = cwColumns.filter(x=>x.startsWith("cw-proj")).length + 1;
  let id = "cw-proj" + i;
  cwColumns.push(id);
  addCourseworkColumn(id, "Project " + i);
}

function addPresentation() {
  let i = cwColumns.filter(x=>x.startsWith("cw-pres")).length + 1;
  let id = "cw-pres" + i;
  cwColumns.push(id);
  addCourseworkColumn(id, "Presentation " + i);
}

function addCourseworkColumn(colId, label) {
  const headerRow2 = document.getElementById("headerRow2");
  const cwTotalTh = headerRow2.querySelector('th[data-role="cw-total"]');

  const th = document.createElement("th");
  th.id = colId;
  th.setAttribute("data-role", "cw-col");
  th.innerHTML = `${label} <button class="delete-col-btn" onclick="deleteColumn('${colId}')">x</button>`;
  headerRow2.insertBefore(th, cwTotalTh);

  document.querySelectorAll("#tbody tr").forEach(row => {
    const cwTotalCell = row.querySelector(".cw-total-cell");
    const td = document.createElement("td");
    td.className = "cw-cell";
    td.setAttribute("data-col", colId);
    td.innerHTML = `<input class="score-box" type="number" oninput="recalc()">`;
    row.insertBefore(td, cwTotalCell);
  });

  updateHeaderSpans();
  recalc();
}

function deleteColumn(colId) {
  cwColumns = cwColumns.filter(id => id !== colId);

  let th = document.getElementById(colId);
  if (th) th.remove();

  document.querySelectorAll(`td[data-col="${colId}"]`).forEach(td => td.remove());

  if (cwColumns.length === 0) cwColumns = ["cw-ut1"];

  updateHeaderSpans();
  recalc();
}

function addStudent() {
  const tbody = document.getElementById("tbody");
  const rowNumber = tbody.children.length + 1;
  const tr = document.createElement("tr");

  let html = `
    <td>${rowNumber}</td>
    <td class="label-col"><input class="name-box" placeholder="Student Name"></td>
  `;

  cwColumns.forEach(colId => {
    html += `
      <td class="cw-cell" data-col="${colId}">
        <input class="score-box" type="number" oninput="recalc()">
      </td>
    `;
  });

  html += `
    <td class="cw-total-cell">0.00</td>
    <td class="exam-cell exam-score-cell">
      <input class="score-box" type="number" value="0" oninput="recalc()">
    </td>
    <td class="exam-cell exam-total-cell">0.00</td>
    <td class="total-cell final-total-cell">0.00</td>
  `;

  tr.innerHTML = html;
  tbody.appendChild(tr);
  recalc();
}

function clamp100(v) {
  v = parseFloat(v);
  if (isNaN(v)) return 0;
  return Math.max(0, Math.min(100, v));
}

function recalc() {
  document.querySelectorAll("#tbody tr").forEach(row => {

    let uts = [];
    let nonUTs = [];

    row.querySelectorAll("td[data-col]").forEach(td => {
      let input = td.querySelector("input");
      let v = clamp100(input.value);
      input.value = v;

      if (td.dataset.col.startsWith("cw-ut")) uts.push(v);
      else nonUTs.push(v);
    });

    let cw40 = 0;

    if (uts.length > 0 && nonUTs.length === 0) {
      cw40 = (uts.reduce((a,b)=>a+b,0) / uts.length) / 100 * 40;
    }
    else if (nonUTs.length > 0 && uts.length === 0) {
      cw40 = (nonUTs.reduce((a,b)=>a+b,0) / nonUTs.length) / 100 * 40;
    }
    else {
      let utAvg = uts.length ? uts.reduce((a,b)=>a+b,0) / uts.length : 0;
      let npAvg = nonUTs.length ? nonUTs.reduce((a,b)=>a+b,0) / nonUTs.length : 0;
      cw40 = utAvg/100 * 25 + npAvg/100 * 15;
    }

    row.querySelector(".cw-total-cell").textContent = cw40.toFixed(2);

    let examInput = row.querySelector(".exam-score-cell input");
    let examRaw = clamp100(examInput.value);
    let exam60 = examRaw / 100 * 60;

    row.querySelector(".exam-total-cell").textContent = exam60.toFixed(2);
    row.querySelector(".final-total-cell").textContent = (cw40 + exam60).toFixed(2);
  });
}

function importExcel() {
  alert("Import placeholder – ready to connect backend.");
}

function exportExcel() {
  const table = document.getElementById("assessmentTable");
  const wb = XLSX.utils.table_to_book(table);
  XLSX.writeFile(wb, "year1_assessment.xlsx");
}

function submitScores() {
  alert("Scores submitted! (placeholder)");
}

document.addEventListener("DOMContentLoaded", () => {
  updateHeaderSpans();
  recalc();
});

</script>

</body>
</html>
